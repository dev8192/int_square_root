
/*
Different values of initial guess:
0x200000000000000000000000000000000 num
0x20000000000000000                 1n << (BigInt(num.toString(2).length) >> 1n)
0x6a09e667f3bcc908                  result
*/
function isqrt(num) {
    console.log(num.toString(16))
    if (num < 2n) return num
    // let prevGuess = num
    let prevGuess = 1n << (BigInt(num.toString(2).length) >> 1n)
    // let prevGuess = 0x16a09e667f3bcc908n
    // let prevGuess = 0x16a09e667f3bcc908n - 1n
    // let prevGuess = 0x16a09e667f3bcc908n + 1n
    let newGuess = (prevGuess + num / prevGuess) >> 1n
    // let newGuess = (prevGuess + 1n) >> 1n
    // let newGuess = prevGuess >> 1n
    console.log(prevGuess.toString(16))
    while (newGuess < prevGuess) {
        prevGuess = newGuess
        newGuess = (prevGuess + num / prevGuess) >> 1n
        console.log(prevGuess.toString(16))
    }
    return prevGuess
}
function compute(num) {
    num = BigInt(num)
    const intPart = isqrt(num)
    console.log('intPart', intPart)
    const scaledNum = num << 128n
    const scaledRoot = isqrt(scaledNum)
    const fracPart = scaledRoot - (intPart << 64n)
    return fracPart
}

function test() {
    const result = compute(2)
    console.log(result.toString(16))
    console.log(result === 0x6a09e667f3bcc908n)
}

function test1() {
    const result = isqrt(2n << 128n)
    console.log(result.toString(16))
    console.log(result === 0x16a09e667f3bcc908n)
}

test()


/*
0x200000000000000000000000000000000n
0x100000000000000000000000000000000n
0x80000000000000000000000000000001n
0x40000000000000000000000000000002n
0x20000000000000000000000000000004n
0x10000000000000000000000000000009n
0x8000000000000000000000000000014n
0x4000000000000000000000000000029n
0x2000000000000000000000000000054n
0x10000000000000000000000000000a9n
0x800000000000000000000000000154n
0x4000000000000000000000000002a9n
0x200000000000000000000000000554n
0x100000000000000000000000000aa9n
0x80000000000000000000000001554n
0x40000000000000000000000002aa9n
0x20000000000000000000000005554n
0x1000000000000000000000000aaa9n
0x8000000000000000000000015554n
0x400000000000000000000002aaa9n
0x2000000000000000000000055554n
0x10000000000000000000000aaaa9n
0x800000000000000000000155554n
0x4000000000000000000002aaaa9n
0x200000000000000000000555554n
0x100000000000000000000aaaaa9n
0x80000000000000000001555554n
0x40000000000000000002aaaaa9n
0x20000000000000000005555554n
0x1000000000000000000aaaaaa9n
0x8000000000000000015555554n
0x400000000000000002aaaaaa9n
0x2000000000000000055555554n
0x10000000000000000aaaaaaa9n
0x800000000000000155555554n
0x4000000000000002aaaaaaa9n
0x200000000000000555555554n
0x100000000000000aaaaaaaa9n
0x80000000000001555555554n
0x40000000000002aaaaaaaa9n
0x20000000000005555555554n
0x1000000000000aaaaaaaaa9n
0x8000000000015555555554n
0x400000000002aaaaaaaaa9n
0x2000000000055555555554n
0x10000000000aaaaaaaaaa8n
0x800000000155555555549n
0x4000000002aaaaaaaaa4fn
0x20000000055555555527cn
0x100000000aaaaaaaa93e8n
0x80000001555555549f49n
0x40000002aaaaaaa4fa4fn
0x2000000555555527d27cn
0x1000000aaaaaa93e93e8n
0x8000015555549f49f51n
0x400002aaaaa4fa4fb64n
0x200005555527d27f529n
0x10000aaaa93e942e982n
0x800155549f4a7f5230n
0x4002aaa4fa60fb2d90n
0x20055527d4a7d96debn
0x100aa93ed9350d94e4n
0x81549fd43958ad87bn
0x42a50b6f45dde6d42n
0x2529e2e268bffa255n
0x1978636273c5cce06n
0x16c93bc9653367f2cn
0x16a0c298da7b0a317n
0x16a09e669c2f3c9bfn
0x16a09e667f3bcc909n
0x16a09e667f3bcc908n
0x6a09e667f3bcc908n
*/
